version: '3.8'

services:
  fusion_service:
    build:
      context: .
      dockerfile: dockerfile
    environment:
      - TZ=Europe/Paris
      - DEBIAN_FRONTEND=noninteractive
    container_name: dns_ad
    ports:
      - "2222:22"        # SSH
      - "53:53/udp"      # DNS (Bind9)
      - "53:53/tcp"
      - "445:445"        # Samba
      - "139:139"
      - "389:389"        # LDAP pour Samba
    networks:
      shared_net:
        ipv4_address: 192.168.0.2
    volumes:
      - ./bind/named.conf:/etc/bind/named.conf:ro
      - ./bind/named.conf.options:/etc/bind/named.conf.options:ro
      - ./bind/zones:/etc/bind/zones:ro
      - ./bind/db.local:/etc/bind/db.local:ro
      - ./bind/db.127:/etc/bind/db.127:ro
      - ./bind/db.0:/etc/bind/db.0:ro
      - ./bind/db.255:/etc/bind/db.255:ro
      - ./samba:/etc/samba
    privileged: true

networks:
  shared_net:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.0.0/24
